<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Edit Sheet</title>
		<link rel="stylesheet" href="styles/styles.css" />
		<link rel="stylesheet" href="styles/edit.css" />
		<link rel="stylesheet" href="styles/home.css" />
		<% const _serverDepartments = typeof departments !== 'undefined' ?
		departments : []; %>
		<% const _selectedYear = typeof selectedYear !== 'undefined' ?
		selectedYear : ''; %>

		<script type="application/json" id="server-data">
			<%- JSON.stringify({departments: _serverDepartments, selectedYear: _selectedYear}) %>
		</script>

		<script>
			const data = JSON.parse(
				document.getElementById("server-data").textContent
			);
			window.serverDepartments = data.departments;
		</script>

		<script type="module" src="js/edit.js" defer></script>
	</head>
	<body>
		<header>
			<nav class="navigation-bar">
				<a href="/">
					<h1>Green River College</h1>
				</a>
				<% if (user) { %>
				<form action="/logout" method="POST" style="display: inline">
					<button type="submit" class="btn-signIn">Logout</button>
				</form>
				<% } %>
			</nav>
		</header>
		<main>
			<form id="page-form" class="content-container" action="" method="get">
				<!-- Master Edit Form Buttons -->
				<div class="form-edit-container">
					<button type="button" id="edit-form-btn" style="display: none">
						Edit Form
					</button>
					<button type="button" id="save-form-btn" style="display: none">
						Save Changes
					</button>
					<button type="button" id="cancel-form-btn" style="display: none">
						Cancel
					</button>
					<button type="button" id="return-btn">Return to homepage</button>
					<button
						type="button"
						id="show-more-btn"
						style="display: none"
						value="false"
					>
						Show More
					</button>
				</div>

			<fieldset id="div-select-set" class="top-section fieldset">
				<label for="year-select">Academic Year</label>
				<select name="year" id="year-select">
					<option value="" <%= _selectedYear === '' ? 'selected' : '' %>>-- All Divisions --</option>
					<option value="2025-2026" <%= _selectedYear === '2025-2026' ? 'selected' : '' %>>2025-2026</option>
					<option value="2026-2027" <%= _selectedYear === '2026-2027' ? 'selected' : '' %>>2026-2027</option>
					<option value="2027-2028" <%= _selectedYear === '2027-2028' ? 'selected' : '' %>>2027-2028</option>
					<option value="2028-2029" <%= _selectedYear === '2028-2029' ? 'selected' : '' %>>2028-2029</option>
					<option value="2029-2030" <%= _selectedYear === '2029-2030' ? 'selected' : '' %>>2029-2030</option>
				</select>

				<label for="division-select">Choose a Division</label>
				<select name="division" id="division-select">
						<option value="">-- Select division --</option>
						<% if (_serverDepartments && _serverDepartments.length) {
						_serverDepartments.forEach(function (d) { %>
						<option
							value="<%= d.divisionName %>"
							data-dean="<%= d.deanName %>"
							data-pen="<%= d.penContact %>"
							data-loc="<%= d.locRep %>"
							data-chair="<%= d.chairName %>"
						>
							<%= d.divisionName %>
						</option>
						<% }); } %>
					</select>
					<label for="dean-input">Dean: </label>
					<input type="text" id="dean-input" disabled />

					<label for="pen-input">PEN Contact: </label>
					<input type="text" id="pen-input" disabled />

					<label for="loc-input">LOC Representative: </label>
					<input type="text" id="loc-input" disabled />

					<label for="chair-input">Chair: </label>
					<input type="text" id="chair-input" disabled />
				</fieldset>

				<section id="programs-container" class="container">
					<% if (_serverDepartments && _serverDepartments.length) {
					_serverDepartments.forEach(function (division) {
					division.programList.forEach(function (p) { %>
					<fieldset
						class="program"
						id="<%= p.programName %>-program"
						style="display: none"
					>
						<p class="p-title"><%= p.programName %></p>

						<section class="payee-container program-sections">
							<% let payeeIndex = 1; for (const [name, amount] of
							Object.entries(p.payees)) { %>
							<div class="payee-item">
								<label>Payee #<%= payeeIndex %></label>
								<div class="program-payee-input-section grid">
									<input type="text" value="<%= name %>" disabled />
									<input type="number" value="<%= amount %>" disabled />
									<button
										type="button"
										class="remove-payee-btn"
										disabled
										style="<%= Object.keys(p.payees).length ? '' : 'display:none' %>"
									>
										Remove
									</button>
								</div>
							</div>
							<% payeeIndex++; } %>
							<button type="button" class="add-payee-btn" disabled>
								Add Payee
							</button>
						</section>

						<fieldset class="program-money-section">
							<div>
								<label>Has been paid</label>
								<input type="checkbox" <%= p.hasBeenPaid ? "checked" : "" %>
								disabled />
							</div>
							<div>
								<label>Submitted</label>
								<input type="checkbox" <%= p.reportSubmitted ? "checked" : "" %>
								disabled />
							</div>
						</fieldset>

						<fieldset class="program-notes-section">
							<label>Notes</label>
							<textarea disabled><%= p.notes %></textarea>
						</fieldset>

						<button type="button" class="remove-program-btn" disabled>
							Remove
						</button>
						<button type="button" class="move-program-btn" disabled>
							Move to...
						</button>
					</fieldset>
					<% }); }); } %>
					<button
						type="button"
						id="add-program-btn"
						style="display: none; order: 999"
					>
						Add a Program
					</button>
				</section>
			</form>

			<!-- Move to Modal -->
			<div id="move-program-modal" class="modal" style="display: none">
				<div
					class="modal-backdrop"
					id="move-modal-backdrop"
					style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5)"
				></div>
				<div
					class="modal-content"
					style="
						position: fixed;
						left: 50%;
						top: 50%;
						transform: translate(-50%, -50%);
						background: #fff;
						padding: 0;
						max-width: 500px;
						width: 95%;
						border-radius: 6px;
						display: flex;
						flex-direction: column;
					"
				>
					<header
						style="
							display: flex;
							justify-content: space-between;
							align-items: center;
							padding: 16px 20px;
							border-bottom: 1px solid #e0e0e0;
						"
					>
						<h2 id="move-modal-title">Move Program</h2>
						<button id="move-modal-close" class="btn-small" aria-label="Close">
							Ã—
						</button>
					</header>
					<section id="move-modal-body" style="padding: 20px">
						<p
							id="move-program-name"
							style="margin-bottom: 16px; font-weight: 600"
						></p>
						<label
							for="target-division-select"
							style="display: block; margin-bottom: 8px"
							>Select target division:</label
						>
						<select
							id="target-division-select"
							style="
								width: 100%;
								padding: 8px;
								border: 1px solid #ccc;
								border-radius: 4px;
							"
						>
							<option value="">-- Select division --</option>
						</select>
					</section>
					<footer
						style="
							display: flex;
							justify-content: flex-end;
							gap: 8px;
							padding: 12px 20px;
							border-top: 1px solid #e0e0e0;
						"
					>
						<button id="move-modal-cancel" class="btn-small">Cancel</button>
						<button
							id="move-modal-confirm"
							class="btn-small"
							style="background: #007bff; color: #fff"
						>
							Move
						</button>
					</footer>
				</div>
			</div>
		</main>
	</body>
</html>
